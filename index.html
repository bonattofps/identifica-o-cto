<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identifica√ß√£o T√©cnica CTO</title>
<style>
  /* --- VISUAL BASEADO NOS SEUS PRINTS --- */
  :root {
    --bg-main: #0b1120;   /* Fundo quase preto */
    --bg-card: #111827;   /* Fundo do card/inputs */
    --border: #1f2937;    /* Bordas sutis */
    --text-main: #ffffff;
    --text-muted: #9ca3af;
    --accent: #3b82f6;    /* Azul padr√£o */
    --success: #10b981;   /* Verde do bot√£o copiar */
  }

  body { margin: 0; font-family: "Segoe UI", Roboto, sans-serif; background: var(--bg-main); color: var(--text-main); }
  .container { max-width: 1000px; margin: 40px auto; padding: 20px; }

  /* T√≠tulo */
  h1 { 
    text-align: center; color: var(--accent); margin-bottom: 40px; 
    font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
    border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 10px;
  }
  .header-wrapper { text-align: center; }

  /* Inputs Escuros */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .form-group { display: flex; flex-direction: column; }
  .full { grid-column: span 2; }
  
  label { font-size: 13px; margin-bottom: 8px; color: var(--text-muted); font-weight: 600; }
  
  input, textarea {
    background: #1f2937; /* Cinza bem escuro */
    color: white; 
    border: 1px solid #374151;
    border-radius: 6px; padding: 12px; font-size: 14px; outline: none; transition: 0.2s;
  }
  input:focus, textarea:focus { border-color: var(--accent); }
  textarea { resize: vertical; min-height: 100px; }
  
  /* Placeholder mais claro */
  ::placeholder { color: #4b5563; }

  /* Bot√£o de Upload Tracejado */
  .upload-area {
    border: 2px dashed #4b5563; background: rgba(31, 41, 55, 0.5);
    padding: 25px; text-align: center; border-radius: 6px; cursor: pointer;
    transition: 0.2s; position: relative;
  }
  .upload-area:hover { border-color: var(--accent); background: rgba(59, 130, 246, 0.1); }
  .upload-text { font-weight: 600; color: var(--text-muted); text-transform: uppercase; font-size: 13px; letter-spacing: 0.5px;}
  .upload-icon { margin-right: 8px; }
  #inputFoto { display: none; }
  #statusFoto { text-align: center; color: var(--success); font-weight: bold; margin-top: 8px; font-size: 13px; }

  /* √Årea de Texto Gerado */
  .output-box {
    margin-top: 30px; background: #0f172a; border: 1px solid #1e293b;
    border-radius: 8px; padding: 20px;
  }
  .output-label { color: var(--accent); font-size: 13px; font-weight: bold; margin-bottom: 10px; display: block; }
  .output-textarea {
    width: 100%; min-height: 100px; background: transparent; border: none;
    color: #e5e7eb; font-family: monospace; resize: none; outline: none;
  }

  /* Bot√µes Largos */
  .btn-row { display: flex; gap: 15px; margin-top: 20px; }
  button {
    padding: 14px; border: none; border-radius: 6px; font-weight: 700; 
    cursor: pointer; flex: 1; color: white; text-transform: uppercase; font-size: 14px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
  }
  .btn-copy { background: var(--success); }
  .btn-copy:hover { background: #059669; }
  
  .btn-save { background: var(--accent); }
  .btn-save:hover { background: #2563eb; }
  .btn-save:disabled { background: #4b5563; cursor: not-allowed; opacity: 0.7; }

  /* Tabela */
  h2 { color: var(--accent); margin-top: 50px; font-size: 16px; border-bottom: 1px solid #374151; padding-bottom: 10px; }
  .table-responsive { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid #374151; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 600px; background: #111827; }
  th { text-align: left; color: var(--accent); padding: 15px; border-bottom: 2px solid #374151; background: #0f172a; white-space: nowrap; }
  td { padding: 12px 15px; border-bottom: 1px solid #374151; color: #d1d5db; }
  tr:hover { background: #1f2937; }

  .thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 4px; border: 1px solid #4b5563; background: black; }
  
  @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } .full { grid-column: span 1; } .btn-row { flex-direction: column; } }
</style>
</head>
<body>

<div class="container">
  <div class="header-wrapper"><h1>IDENTIFICA√á√ÉO T√âCNICA CTO</h1></div>

  <div class="form-grid">
    <div class="form-group"><label>OLT</label><input id="olt" type="text" placeholder="Ex: GIGA-JAW-LIB-COA"></div>
    <div class="form-group"><label>Slot / PON</label><input id="pon" type="text" placeholder="Ex: 0-0-13-6"></div>
    <div class="form-group"><label>T√©cnico de Campo</label><input id="tecnico" type="text" placeholder="Nome do T√©cnico"></div>
    <div class="form-group"><label>Suporte Respons√°vel</label><input id="suporte" type="text" placeholder="Seu Nome"></div>

    <div class="full">
      <label>Foto do Servi√ßo (Opcional)</label>
      <label class="upload-area">
        <span class="upload-icon">üì∑</span>
        <span class="upload-text">TOQUE PARA ESCOLHER A FOTO</span>
        <input type="file" id="inputFoto" accept="image/*" onchange="processarFoto()">
      </label>
      <div id="statusFoto"></div>
    </div>

    <div class="full"><label>Observa√ß√µes</label><textarea id="obs" placeholder="Descreva o servi√ßo realizado..."></textarea></div>
  </div>

  <div class="output-box">
    <label class="output-label">Texto Gerado</label>
    <textarea id="saida" class="output-textarea" readonly></textarea>
  </div>

  <div class="btn-row">
    <button class="btn-copy" onclick="copiar()">COPIAR TEXTO</button>
    <button class="btn-save" id="btnSalvar" onclick="salvar()">SALVAR NO HIST√ìRICO</button>
  </div>

  <h2>Hist√≥rico de Atendimentos (Rond√¥nia GMT-4)</h2>
  <div class="table-responsive">
    <table id="tabelaHistorico">
      <thead><tr><th>Data/Hora</th><th>OLT</th><th>PON</th><th>T√©cnico</th><th>Suporte</th><th>Foto</th><th>Obs</th></tr></thead>
      <tbody id="listaHistorico"><tr><td colspan="7" style="text-align:center; padding:20px;">Carregando hist√≥rico...</td></tr></tbody>
    </table>
  </div>
  
  <div style="text-align:center; margin-top:40px; color:#6b7280; font-size:12px;">Desenvolvido by Juander</div>
</div>

<script>
// ==============================================================
// COLE SUA URL AQUI DENTRO DAS ASPAS:
const API_URL = "COLE_A_URL_DO_APP_DA_WEB_AQUI";
// ==============================================================

let imagemBase64 = "";

const ids = ["olt","pon","tecnico","suporte","obs"];
ids.forEach(id => document.getElementById(id).addEventListener("input", gerarTexto));

function gerarTexto() {
  const v = (id) => document.getElementById(id).value || "...";
  document.getElementById("saida").value = 
`Identifica√ß√£o T√©cnica

OLT: ${v('olt').toUpperCase()}
SLOT/PON: ${v('pon')}
T√âCNICO: ${v('tecnico')}
SUPORTE: ${v('suporte')}
OBS: ${v('obs')}`;
}

function processarFoto() {
  const file = document.getElementById('inputFoto').files[0];
  if(!file) return;
  document.getElementById('statusFoto').innerText = "‚è≥ Processando...";
  const reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onload = function(event) {
    const img = new Image();
    img.src = event.target.result;
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const MAX_WIDTH = 800; 
      const scaleSize = MAX_WIDTH / img.width;
      canvas.width = MAX_WIDTH;
      canvas.height = img.height * scaleSize;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      imagemBase64 = canvas.toDataURL('image/jpeg', 0.7);
      document.getElementById('statusFoto').innerText = "‚úÖ Foto pronta: " + file.name;
    }
  }
}

function copiar() {
  document.getElementById("saida").select();
  document.execCommand("copy");
  alert("Texto copiado!");
}

async function salvar() {
  const btn = document.getElementById("btnSalvar");
  const olt = document.getElementById("olt").value;
  const tecnico = document.getElementById("tecnico").value;

  if(!olt || !tecnico) return alert("Erro: Preencha OLT e T√©cnico!");
  
  btn.innerText = "ENVIANDO...";
  btn.disabled = true;

  const dados = {
    olt: olt,
    pon: document.getElementById("pon").value,
    tecnico: tecnico,
    suporte: document.getElementById("suporte").value,
    obs: document.getElementById("obs").value,
    imagem: imagemBase64
  };

  try {
    await fetch(API_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(dados) });
    alert("Salvo com sucesso!");
    location.reload();
  } catch (error) {
    alert("Erro ao salvar: " + error);
    btn.disabled = false;
    btn.innerText = "SALVAR NO HIST√ìRICO";
  }
}

async function carregar() {
  const tbody = document.getElementById("listaHistorico");
  try {
    const response = await fetch(API_URL + "?t=" + new Date().getTime());
    const dados = await response.json();
    tbody.innerHTML = "";

    if (dados.length === 0) {
      tbody.innerHTML = "<tr><td colspan='7' style='text-align:center'>Nenhum registro.</td></tr>";
      return;
    }

    dados.reverse().forEach(row => {
      // Limpeza de ' e corre√ß√£o visual
      let dataF = row[0] ? row[0].toString().replace(/^'/, "") : "-";
      let ponF = row[2] ? row[2].toString().replace(/^'/, "") : "-";
      let linkHtml = (row[5] && row[5].includes("http")) ? 
        `<a href="${row[5]}" target="_blank"><img src="${row[5]}" class="thumb"></a>` : "-";

      tbody.innerHTML += `<tr>
        <td>${dataF}</td>
        <td>${row[1]}</td>
        <td>${ponF}</td>
        <td>${row[3]}</td>
        <td>${row[4]}</td>
        <td style="text-align:center">${linkHtml}</td>
        <td style="white-space:normal; max-width:200px;">${row[6]}</td>
      </tr>`;
    });
  } catch (e) {
    tbody.innerHTML = "<tr><td colspan='7' style='text-align:center; color:#ef4444'>Erro ao carregar tabela.</td></tr>";
  }
}

window.onload = carregar;
</script>
</body>
</html>
