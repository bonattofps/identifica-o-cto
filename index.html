<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identifica√ß√£o T√©cnica CTO | N2/N3</title>

<style>
  /* --- ESTILO DARK MODE --- */
  body { margin: 0; font-family: "Segoe UI", Arial, sans-serif; background: #0f172a; color: #e5e7eb; }
  .container { max-width: 1200px; margin: 40px auto; padding: 20px; }
  h1 { text-align: center; color: #3b82f6; margin-bottom: 30px; font-weight: 700; letter-spacing: 1px; }
  
  /* Layout */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .form-group { display: flex; flex-direction: column; }
  .full-width { grid-column: span 2; }
  
  /* Inputs */
  label { font-size: 13px; margin-bottom: 8px; color: #94a3b8; font-weight: 600; }
  input, textarea { background: #1e293b; color: #f8fafc; border: 1px solid #334155; border-radius: 6px; padding: 12px; font-size: 14px; outline: none; transition: 0.3s; }
  input:focus, textarea:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
  textarea { resize: vertical; min-height: 100px; }

  /* Bot√£o de Foto */
  .file-upload-wrapper { position: relative; width: 100%; height: 50px; border: 2px dashed #475569; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; background: #1e293b; }
  .file-upload-wrapper:hover { border-color: #3b82f6; background: #263345; }
  .file-upload-text { color: #94a3b8; font-size: 14px; font-weight: 500; }
  #inputFoto { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
  #statusFoto { text-align: center; font-size: 13px; margin-top: 8px; font-weight: bold; min-height: 20px; color: #22c55e; }

  /* √Årea de Sa√≠da */
  .output-area { margin-top: 40px; background: #1e293b; padding: 20px; border-radius: 8px; border: 1px solid #334155; }
  .output-area textarea { background: #0f172a; border: none; font-family: monospace; }
  
  /* Bot√µes */
  .action-buttons { display: flex; gap: 15px; margin-top: 20px; }
  button { flex: 1; padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 15px; }
  .btn-copy { background: #22c55e; color: #022c22; }
  .btn-copy:hover { background: #16a34a; }
  .btn-save { background: #3b82f6; color: white; }
  .btn-save:hover { background: #2563eb; }
  .btn-save:disabled { background: #64748b; opacity: 0.7; cursor: not-allowed; }

  /* Tabela */
  h2 { color: #3b82f6; font-size: 1.1rem; margin-top: 50px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
  .table-wrapper { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid #334155; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; background: #1e293b; white-space: nowrap; }
  th { background: #0f172a; color: #3b82f6; padding: 15px; text-align: left; border-bottom: 2px solid #334155; }
  td { padding: 12px 15px; border-bottom: 1px solid #334155; color: #cbd5e1; vertical-align: middle; }
  tr:hover { background: #263345; }
  
  /* Miniatura */
  .thumb-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #475569; transition: 0.2s; cursor: pointer; background: #000; }
  .thumb-img:hover { transform: scale(3); border-color: #3b82f6; z-index: 100; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
  
  footer { margin-top: 50px; text-align: center; color: #64748b; font-size: 12px; padding-bottom: 20px; }
  @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } .full-width { grid-column: span 1; } }
</style>
</head>

<body>

<div class="container">
  <h1>Identifica√ß√£o T√©cnica CTO</h1>

  <div class="form-grid">
    <div class="form-group"><label>OLT</label><input id="olt" type="text" placeholder="Ex: GIGA-JAW-LIB-COA"></div>
    <div class="form-group"><label>Slot / PON</label><input id="pon" type="text" placeholder="Ex: 0-0-13-6"></div>
    <div class="form-group"><label>T√©cnico de Campo</label><input id="tecnico" type="text" placeholder="Nome do t√©cnico"></div>
    <div class="form-group"><label>Suporte Respons√°vel</label><input id="suporte" type="text" placeholder="Seu nome"></div>

    <div class="form-group full-width">
      <label>Foto do Servi√ßo (Opcional)</label>
      <div class="file-upload-wrapper">
        <span class="file-upload-text">üì∏ Clique aqui para anexar a foto</span>
        <input type="file" id="inputFoto" accept="image/*" onchange="processarFoto()">
      </div>
      <div id="statusFoto"></div>
    </div>

    <div class="form-group full-width"><label>Observa√ß√µes</label><textarea id="obs" placeholder="Descreva o servi√ßo realizado..."></textarea></div>
  </div>

  <div class="output-area">
    <label style="color:#3b82f6">Texto Gerado</label>
    <textarea id="saida" readonly></textarea>
    <div class="action-buttons">
      <button class="btn-copy" onclick="copiar()">Copiar Texto</button>
      <button class="btn-save" id="btnSalvar" onclick="salvar()">Salvar no Hist√≥rico</button>
    </div>
  </div>

  <h2>Hist√≥rico de Atendimentos (Rond√¥nia GMT-4)</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>OLT</th>
          <th>Slot/PON</th>
          <th>T√©cnico</th>
          <th>Suporte</th>
          <th>Foto</th>
          <th>Observa√ß√µes</th>
        </tr>
      </thead>
      <tbody id="listaHistorico">
        <tr><td colspan="7" style="text-align:center; padding:20px;">Carregando hist√≥rico...</td></tr>
      </tbody>
    </table>
  </div>
  
  <footer>Desenvolvido by Juander</footer>
</div>

<script>
// SEU LINK DO GOOGLE APPS SCRIPT
const API_URL = "https://script.google.com/macros/s/AKfycbxXfwkb331T9w1z5viqhqUjjPQhrLmykHmUrSd7rbhWTUV-6lQuha5qC1Y8XZx2uSaA4A/exec";
let imagemBase64 = "";

// GERA O TEXTO
const ids = ["olt","pon","tecnico","suporte","obs"];
ids.forEach(id => document.getElementById(id).addEventListener("input", () => {
  const v = (i) => document.getElementById(i).value || "...";
  document.getElementById("saida").value = `Identifica√ß√£o T√©cnica\n\nOLT: ${v('olt')}\nSLOT/PON: ${v('pon')}\nT√âCNICO: ${v('tecnico')}\nSUPORTE: ${v('suporte')}\nOBS: ${v('obs')}`;
}));

function copiar() {
  document.getElementById("saida").select();
  document.execCommand("copy");
  alert("Texto copiado!");
}

function processarFoto() {
  const file = document.getElementById('inputFoto').files[0];
  if(file) {
    const reader = new FileReader();
    reader.onloadend = () => {
      imagemBase64 = reader.result;
      document.getElementById('statusFoto').innerText = "‚úÖ Foto pronta: " + file.name;
    };
    reader.readAsDataURL(file);
  }
}

async function salvar() {
  const btn = document.getElementById("btnSalvar");
  const dados = {
    olt: document.getElementById("olt").value,
    pon: document.getElementById("pon").value,
    tecnico: document.getElementById("tecnico").value,
    suporte: document.getElementById("suporte").value,
    obs: document.getElementById("obs").value,
    imagem: imagemBase64
  };

  if(!dados.olt || !dados.tecnico) return alert("Preencha OLT e T√©cnico!");

  btn.innerText = "Enviando...";
  btn.disabled = true;

  try {
    await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dados) });
    alert("Salvo com sucesso!");
    location.reload();
  } catch (e) {
    alert("Erro ao salvar: " + e);
    btn.disabled = false;
    btn.innerText = "Salvar no Hist√≥rico";
  }
}

async function carregar() {
  const tbody = document.getElementById("listaHistorico");
  try {
    const res = await fetch(API_URL);
    const dados = await res.json();
    tbody.innerHTML = "";
    
    dados.reverse().forEach(row => {
      // Remove a trava (') para exibir o texto limpo
      const dataFormatada = row[0].toString().replace(/^'/, "");
      const ponFormatada = row[2].toString().replace(/^'/, "");
      
      const linkFoto = row[6];
      let imgHtml = '<span style="color:#64748b;font-size:11px">Sem foto</span>';
      
      if(linkFoto && linkFoto.includes("http")) {
        imgHtml = `<a href="${linkFoto}" target="_blank"><img src="${linkFoto}" class="thumb-img" title="Ver foto"></a>`;
      }

      tbody.innerHTML += `
        <tr>
          <td>${dataFormatada}</td>
          <td>${row[1]}</td>
          <td>${ponFormatada}</td>
          <td>${row[3]}</td>
          <td>${row[4]}</td>
          <td style="text-align:center">${imgHtml}</td>
          <td style="white-space:normal; max-width:300px;">${row[5]}</td>
        </tr>
      `;
    });
  } catch(e) {
    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;color:red">Erro ao carregar tabela.</td></tr>`;
  }
}

window.onload = carregar;
</script>
</body>
</html>
