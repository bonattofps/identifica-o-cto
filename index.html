<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identifica√ß√£o T√©cnica CTO</title>

<style>
  /* --- TEMA UNI (Azul Navy e Laranja) --- */
  :root {
    --bg-color: #001233;       /* Azul muito escuro de fundo */
    --card-color: #001f54;     /* Azul navy para os blocos */
    --input-bg: #032b6e;       /* Azul para inputs */
    --text-color: #e2e8f0;     /* Texto claro */
    --accent-orange: #ff6600;  /* Laranja Uni */
    --accent-gradient: linear-gradient(135deg, #ff8800, #ff5500);
    --border-color: #1e3a8a;
  }

  body { margin: 0; font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg-color); color: var(--text-color); }
  
  .container { max-width: 1000px; margin: 30px auto; padding: 20px; }

  /* CABE√áALHO */
  h1 { 
    text-align: center; 
    color: white; 
    margin-bottom: 30px; 
    font-weight: 800; 
    text-transform: uppercase; 
    letter-spacing: 1px;
    border-bottom: 3px solid var(--accent-orange);
    display: inline-block;
    padding-bottom: 10px;
  }
  .header-container { text-align: center; width: 100%; }

  /* FORMUL√ÅRIO */
  .form-card {
    background: var(--card-color);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
  }

  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .full-width { grid-column: span 2; }
  
  label { font-size: 13px; margin-bottom: 8px; color: #93c5fd; font-weight: 600; display: block; }
  
  input, textarea { 
    width: 100%;
    background: var(--input-bg); 
    color: white; 
    border: 1px solid var(--border-color); 
    border-radius: 8px; 
    padding: 12px; 
    font-size: 15px; 
    outline: none; 
    transition: 0.3s; 
    box-sizing: border-box; /* Garante que n√£o estoure a tela */
  }
  
  input:focus, textarea:focus { border-color: var(--accent-orange); box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.2); }
  textarea { resize: vertical; min-height: 100px; }

  /* BOT√ÉO DE FOTO */
  .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; }
  .btn-upload {
    border: 2px dashed #4b5563;
    color: #cbd5e1;
    background-color: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: bold;
    width: 100%;
    cursor: pointer;
    transition: 0.3s;
    text-align: center;
    box-sizing: border-box;
  }
  .upload-btn-wrapper input[type=file] {
    font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%;
  }
  .btn-upload:hover { border-color: var(--accent-orange); color: var(--accent-orange); }
  #statusFoto { text-align: center; color: #4ade80; font-weight: bold; margin-top: 10px; font-size: 13px; min-height: 20px;}

  /* √ÅREA DE TEXTO GERADO */
  .output-area { margin-top: 30px; }
  .output-box {
    background: #020617;
    border: 1px solid #334155;
    border-radius: 8px;
    padding: 15px;
    width: 100%;
    min-height: 120px;
    color: #e2e8f0;
    font-family: monospace;
    box-sizing: border-box;
  }

  /* BOT√ïES DE A√á√ÉO */
  .btn-group { display: flex; gap: 15px; margin-top: 20px; }
  
  button {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 15px;
    cursor: pointer;
    transition: 0.2s;
    text-transform: uppercase;
  }

  .btn-copy { background: #10b981; color: #064e3b; } /* Verde */
  .btn-copy:hover { background: #059669; color: white; }

  .btn-save { background: var(--accent-gradient); color: white; } /* Laranja Uni */
  .btn-save:hover { filter: brightness(1.1); transform: translateY(-1px); }
  .btn-save:disabled { background: #475569; cursor: not-allowed; transform: none; filter: grayscale(1); }

  /* TABELA */
  h2 { color: var(--accent-orange); margin-top: 50px; border-bottom: 1px solid #1e3a8a; padding-bottom: 10px; font-size: 1.2rem; }
  
  .table-responsive { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border-color); margin-top: 20px; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; background: var(--card-color); }
  
  th { background: #00102b; color: var(--accent-orange); padding: 15px; text-align: left; border-bottom: 2px solid var(--border-color); }
  td { padding: 12px 15px; border-bottom: 1px solid #1e293b; color: #cbd5e1; }
  tr:hover { background: #032b6e; }

  .thumb { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; border: 1px solid #fff; cursor: pointer; transition: 0.2s; background: #000; }
  .thumb:hover { transform: scale(3); border-color: var(--accent-orange); position: relative; z-index: 10; }

  footer { margin-top: 50px; text-align: center; color: #64748b; font-size: 12px; padding-bottom: 20px; }

  /* MOBILE */
  @media (max-width: 600px) {
    .form-grid { grid-template-columns: 1fr; }
    .full-width { grid-column: span 1; }
    .btn-group { flex-direction: column; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header-container">
    <h1>Identifica√ß√£o T√©cnica CTO</h1>
  </div>

  <div class="form-card">
    <div class="form-grid">
      <div class="form-group">
        <label>OLT</label>
        <input id="olt" type="text" placeholder="Ex: GIGA-JAW-LIB-COA">
      </div>
      <div class="form-group">
        <label>Slot / PON</label>
        <input id="pon" type="text" placeholder="Ex: 0-0-13-6">
      </div>
      <div class="form-group">
        <label>T√©cnico de Campo</label>
        <input id="tecnico" type="text" placeholder="Nome do T√©cnico">
      </div>
      <div class="form-group">
        <label>Suporte Respons√°vel</label>
        <input id="suporte" type="text" placeholder="Seu Nome (Suporte)">
      </div>

      <div class="full-width">
        <label>Foto do Servi√ßo (Obrigat√≥rio / Opcional)</label>
        <div class="upload-btn-wrapper">
          <button class="btn-upload">üì∏ Toque para escolher a foto</button>
          <input type="file" id="inputFoto" accept="image/*" onchange="processarFoto()">
        </div>
        <div id="statusFoto">Nenhuma foto selecionada</div>
      </div>

      <div class="full-width">
        <label>Observa√ß√µes</label>
        <textarea id="obs" placeholder="Descreva sinal, cliente offline, portas..."></textarea>
      </div>
    </div>

    <div class="output-area">
      <label>Texto para Copiar (WhatsApp/Sistema)</label>
      <textarea id="saida" class="output-box" readonly></textarea>
      
      <div class="btn-group">
        <button class="btn-copy" onclick="copiar()">Copiar Texto</button>
        <button class="btn-save" id="btnSalvar" onclick="salvar()">Salvar no Hist√≥rico</button>
      </div>
    </div>
  </div>

  <h2>Hist√≥rico Recente (Rond√¥nia)</h2>
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>OLT</th>
          <th>PON</th>
          <th>T√©cnico</th>
          <th>Suporte</th>
          <th>Foto</th>
          <th>Obs</th>
        </tr>
      </thead>
      <tbody id="listaHistorico">
        <tr><td colspan="7" style="text-align:center; padding:20px;">Carregando dados...</td></tr>
      </tbody>
    </table>
  </div>
  
  <footer>Desenvolvido by Juander</footer>
</div>

<script>
// LINK DO SEU SCRIPT
const API_URL = "https://script.google.com/macros/s/AKfycbxXfwkb331T9w1z5viqhqUjjPQhrLmykHmUrSd7rbhWTUV-6lQuha5qC1Y8XZx2uSaA4A/exec";
let imagemBase64 = "";

// GERA O TEXTO AUTOMATICAMENTE AO DIGITAR
const ids = ["olt","pon","tecnico","suporte","obs"];
ids.forEach(id => document.getElementById(id).addEventListener("input", gerarTexto));

function gerarTexto() {
  const v = (i) => document.getElementById(i).value || "...";
  document.getElementById("saida").value = 
`Identifica√ß√£o T√©cnica

OLT: ${v('olt').toUpperCase()}
SLOT/PON: ${v('pon')}
T√âCNICO: ${v('tecnico')}
SUPORTE: ${v('suporte')}
OBS: ${v('obs')}`;
}

// PROCESSA A FOTO
function processarFoto() {
  const file = document.getElementById('inputFoto').files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      imagemBase64 = e.target.result; // Isso pega a string completa da imagem
      document.getElementById('statusFoto').innerText = "‚úÖ Foto carregada: " + file.name;
    };
    reader.readAsDataURL(file);
  }
}

function copiar() {
  document.getElementById("saida").select();
  document.execCommand("copy");
  alert("Texto copiado!");
}

async function salvar() {
  const btn = document.getElementById("btnSalvar");
  const dados = {
    olt: document.getElementById("olt").value,
    pon: document.getElementById("pon").value,
    tecnico: document.getElementById("tecnico").value,
    suporte: document.getElementById("suporte").value,
    obs: document.getElementById("obs").value,
    imagem: imagemBase64 // Envia a foto processada
  };

  if(!dados.olt || !dados.tecnico) return alert("Preencha pelo menos OLT e T√©cnico!");

  btn.innerText = "ENVIANDO...";
  btn.disabled = true;

  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: JSON.stringify(dados)
    });
    alert("Salvo com sucesso!");
    location.reload();
  } catch (e) {
    alert("Erro ao salvar: " + e);
    btn.disabled = false;
    btn.innerText = "Salvar no Hist√≥rico";
  }
}

async function carregar() {
  const tbody = document.getElementById("listaHistorico");
  try {
    const res = await fetch(API_URL);
    const dados = await res.json();
    tbody.innerHTML = "";
    
    dados.reverse().forEach(row => {
      // Remove o ' das datas e PONs para exibir limpo
      const dataF = row[0].toString().replace(/^'/, ""); 
      const ponF = row[2].toString().replace(/^'/, "");
      const link = row[6];
      
      let imgHtml = '<span style="color:#64748b; font-size:10px;">-</span>';
      if(link && link.includes("http")) {
        imgHtml = `<a href="${link}" target="_blank"><img src="${link}" class="thumb" title="Ver foto"></a>`;
      }

      tbody.innerHTML += `
        <tr>
          <td>${dataF}</td>
          <td>${row[1]}</td>
          <td>${ponF}</td>
          <td>${row[3]}</td>
          <td>${row[4]}</td>
          <td style="text-align:center">${imgHtml}</td>
          <td style="white-space:normal; max-width:250px; font-size:12px;">${row[5]}</td>
        </tr>
      `;
    });
  } catch(e) {
    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;">Erro ao carregar hist√≥rico.</td></tr>`;
  }
}

window.onload = carregar;
</script>
</body>
</html>
